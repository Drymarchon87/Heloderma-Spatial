---
title: "Spatial Ecology of Gila Monsters in a Subsidized Resource Environment"
author: "Pierson, M.T., Gienger, C.M., DeNardo, D.F., Parker, M., Gallardo, L., Goode, M., Gentry, C.M."
output:
  html_notebook:
  df_print: paged
  rows.print: 10
  theme: cosmo
  highlight: breezedark
  number_sections: yes
  toc: true
  toc_float:
    collapsed: false
    smooth_scroll: true
pdf_document: default
editor_options: 
chunk_output_type: inline
---
<style type="text/css">

h1.title {
  font-size: 40px;
  font-family: "Calibri", Times, serif;
  color: DarkBlue;
  text-align: center;
}
h4.author { /* Header 4 - and the author and data headers use this too  */
  font-size: 20px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
  text-align: center;
}
</style>

<br>

![Gila Sunset](GILASUNSET.png)

<br>

# ABSTRACT 
Animal movements are often defined using the home range concept. Consequently, home ranges are determined by temporal, spatial, and individual-level processes. Within the environment, one of the key factors influencing an animal’s range and how it uses the environment is that of resources. Alterations to the environment that affect resource distribution and availability can have profound consequences on an animal’s spatial patterns. One of the best examples of this is that of golf courses. Certain environmental modifications exhibited by some human altered environments can have positive effects on certain wildlife species by altering their movement patterns and foraging efforts. We analyzed data collected from 22 Gila Monsters *Heloderma suspectum* at a subsidized environment in Arizona from 2007 to 2013 and 15 Gila Monsters from a non-subsidized environment from 2000 to 2002. We performed both kernel density estimation and minimum convex polygons for comparability purposes. After adjusting area estimates for sex, number of fixes, and year, males in the subsidized environment had an average overall area of 13.6 ha while the females had an area of 8.3 ha. In the unsubsidized environment, males had an average overall area of 43.2 ha while females had an area of 23.6 ha. Gila Monsters between the two environments also exhibited seasonal differences, primarily in the dry and monsoon seasons. There were also differences in home range overlap within and between sexes. In the subsidized population, there was very little male-male overlap with only two occurances, more female-female overlap and male-female overlap was increased. Male home ranges often overlapped several female home ranges. This suggests that Gila monster home ranges may be smaller in subsidized resource environments than those of un-subsidized environments due to increases in available resources.

<br>



```{r setup, include=FALSE}
# LOAD PACKAGES 

library(tidyverse) 
library(knitr) #  make tables
library(leaflet)
library(lme4)
library(lmerTest)
library(readr)
library(ggplot2)
# library(dplyr)
library(ggfortify)
library(ordinal)
library(lsmeans)
library(emmeans)
library(mapview)
library(adehabitatHR)
# library(OpenStreetMap)
library(ggmap)
#knitr::opts_chunk$set(fig.width = 5, fig.asp = 1/3) #force figures to be certain size and aspect ratio
```



# Gila Monsters (*Heloderma suspectum*) and Human Altered Environments
<p>
  Animal movements are often defined using the home range concept. Formally defined by William Burk in 1943 as, "that area traversed by the individual in its normal activities of foraging, mating, and caring for young. Occasional sallies outside the area, perhaps exploratory in nature, should not be considered part of the home range". Consequently, home ranges are determined by temporal, spatial, and individual-level processes. Studying animal HR’s has been of special interest to a wide variety of researchers, including those studying relationships between behavior, age, sex, and spacing patterns, resource distribution as it affects space use, the relationship between metabolic requirements and home range size, and space requirements for purposes of controlling problematic species, conservation, and wildlife management.  
<p>
  Within an animals environment, one of the key factors influencing an animals range and how it uses the environment is that of resources.  Alterations to the environment that affect resource distribution and availability can have profound consequences on an animals spatial patterns. Some of the best examples of this are alterations caused by human activities.  Historically, human alterations to environments have been percieved as having negative consequences on local wildlife populations. However, certain environmental modifications can have positive effects on various wildlife species. This is seen in the implementation of certain golf courses, and green areas. One of the key consequences of golf courses, especially those placed in desert environments is the water irrigation supplementation and horticulture that comes with them. As a result, this enhances primary productivity which increases the presence of vertebrate animals that take advantage of that increase in productivity. In reptiles, faster growth is often correlated with increases in precipitation and available resources. A Recent study by Smith et al., 2010, has shown that Gila Monsters *Heloderma suspectum* inhabiting a golf course in the upland Sonoran of Arizona grew larger and faster than unsubsidized populations.
<p>
  Gila Monsters occupy the hot desert regions of the Mohave Desert in the extreme southeastern  Nevada, south through the Sonoran Desert of Arizona into Sonora and northern Sinaloa, Mexico. Gilas are known to be “widely foraging” animals due to their specialization in feeding on the young and eggs of small vertebrate nests. These characteristics and findings make this species a good candidate for studying the potential alterations to animal home ranges that nutrient subsidized areas such as golf courses may have on animal populations. 
<p>




```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(dismo)
library(rgbif)
library(utils)
library(readxl)
library(spotifyr)
library(ggridges)
library(viridis)
library(rasterVis)

## USING DISMO:
# extent <- extent(-130,-70,20,60)

H.susp <- gbif("heloderma", species = "suspectum", ext = extent,
             geo = TRUE, sp = TRUE, download = TRUE,
             removeZeros = TRUE)

H.susp_xy <- as.data.frame(cbind(H.susp@coords[,1],H.susp@coords[,2]))
colnames(H.susp_xy) <- c("longitude","latitude")

# us <- map_data("state")

# ggplot(data = H.susp_xy, aes(x=longitude, y=latitude)) +
#   geom_polygon(data = us, aes(x=long, y = lat, group = group),
#                fill = "white", color="black") +
#   geom_point() + xlab("Longitude") + ylab("Latitude") +
#   coord_fixed(xlim = c(-120,-106), ylim = c(30,41))

##  USING RGBIF:
H.susp_lu <- name_lookup(query = 'heloderma suspectum', return = 'data')

H.susp_code <- print(as.integer(names(which.max(table(H.susp_lu$nubKey)))))

# occ_count(taxonKey = H.susp_code, georeferenced = TRUE)

usa <- isocodes[grep("United States", isocodes$name), "code"]
mex <- isocodes[grep("Mexico", isocodes$name), "code"]

H.susp_data <- occ_search(taxonKey = H.susp_code, 
                   return = 'data', 
                   country = usa,
                   hasCoordinate = TRUE)

H.susp_data.mex <- occ_search(taxonKey = H.susp_code, 
                   return = 'data', 
                   country = mex,
                   hasCoordinate = TRUE)

H.susp_df <- as.data.frame(cbind(H.susp_data$US$scientificName,
                               H.susp_data$US$institutionCode,
                               H.susp_data$US$stateProvince,
                               H.susp_data$US$verbatimLocality))

H.susp_df.mex <- as.data.frame(cbind(H.susp_data.mex$scientificName,
                               H.susp_data.mex$institutionCode,
                               H.susp_data.mex$stateProvince,
                               H.susp_data.mex$verbatimLocality))

H.susp_df.usmex <- as.data.frame(rbind(H.susp_df,H.susp_df.mex))


coords <- cbind(type.convert(H.susp_data[["US"]][["decimalLongitude"]], as.is = TRUE),
                type.convert(H.susp_data[["US"]][["decimalLatitude"]], as.is = TRUE))

coords.mex <- cbind(type.convert(H.susp_data.mex[["decimalLongitude"]], as.is = TRUE),
                type.convert(H.susp_data.mex[["decimalLatitude"]], as.is = TRUE))

coords <-  rbind(coords,coords.mex)


H.susp_info <- cbind(H.susp_df.usmex,coords)

colnames(H.susp_info) <- c("species","dataset","state","location","longitude","latitude")

world <- map_data("world")
states <- map_data("state")
counties <- map_data("county")

counties$polyname <- paste(counties$region, counties$subregion, sep = ",")
# counties <- counties %>% left_join(fips, by = c("polyname" = "polyname"))
# counties$fips <- as.character(counties$fips)

southwestern_states <- subset(states, region %in% 
                            c("arizona", "california", "utah", "nevada", 
                              "new mexico", "colorado","texas","oklahoma","kansas"))

southwestern_counties <- subset(counties, region %in% 
                              c("arizona", "california", "utah", "nevada", 
                                "new mexico", "colorado","texas","oklahoma","kansas"))

library(raster)
provinces <- c("Sonora","Sinaloa")

mexico <- getData("GADM",country="MEX",level=1)

mex.provinces <- mexico[mexico$NAME_1 %in% provinces,]

ggplot(data = H.susp_info, aes(x=longitude, y=latitude)) + 
  geom_polygon(data = world, aes(x=long,y=lat, group=group), fill = "gray", color ="white")+
  geom_polygon(data = states, aes(x=long,y=lat, group=group), fill = "gray", color = "white")+
  # geom_polygon(data = fl_poly, aes(x=long, y=lat, group=group, fill = fill))  
  geom_polygon(data = southwestern_states, aes(x=long,y=lat, group=group), fill = NA,
               color="white") +
  geom_polygon(data = southwestern_counties, aes(x=long,y=lat, group=group), fill = NA, 
               color = "black", size = 0.05) +
  geom_polygon(data=mex.provinces, aes(x=long,y=lat, group=group), fill = "gray", 
               color ="white") +
  geom_point(aes(color = state), size=1) +
  coord_map("conic", lat0 = 30, xlim=c(-119,-98), ylim=c(23,38)) +
  scale_fill_identity() +
  theme_grey() + theme(legend.position="right") + theme(legend.title.align=0.5) +
  theme(panel.background = element_rect(fill = 'deepskyblue'),
        panel.grid.major = element_line(colour = NA)) +
  labs(x = "Longitude", y = "Latitude", 
       title = "Gila Monster Distribution") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5))
```

<br>



# Study Site

  For the subsidized resource population occupying a human altered environment, spatial data was collected on 22 Gila Monsters, 13 females and 9 males at Stone Canyon Golf Club, located in Pima County, Arizona at the base of the Tortolita Mountains. Stone Canyon is a golf club with an area of approximately 345 hectares, consisting of vegetation that is typical of Sonoran desertscrub habitat of the Arizona uplands. Elevation ranges from 900m-1000m, with the landscape consisting of granite outcrop hills with large boulders throughout, interrupted by watered fairways, ponds and paved cart paths. This golf course possesses a partially urbanized housing development with properties encompassing the perimeter of the course. 

  <br>


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, cache=TRUE}
ggmap::register_google(key = "AIzaSyBjhhE9peRBmS1h9WYQx1k5MF_XAXqUfSs")

p3<- ggmap(get_googlemap(center = c(lon = -110.99088, lat = 32.46878),
                         zoom = 15, scale = 2,maptype ='satellite',archiving = TRUE,
                         color = 'color'))

# p3

Longitude<-c(-110.978,-110.978,-110.980,-110.983,-110.985,-110.988,-110.990,-110.994,-110.995,
             -110.997,-111.003,-111.004,-111.0042,-111.000,-110.995,-110.985,-110.978,-110.98)

Latitude<-c(32.463,32.462,32.462,32.461,32.461,32.460,32.462,32.464,32.466,32.468,32.468,
            32.469,32.473,32.4733,32.472,32.474,32.471,32.467)

mycoorddata <- as.data.frame(cbind(Longitude,Latitude))

p3+geom_polygon(data=mycoorddata,aes(x=Longitude,y=Latitude),alpha=0.2,colour="red",
                fill="red")+
  # geom_path(data=mycoorddata,aes(x=Longitude,y=Latitude),
  #                                     colour="white",alpha=0.4,size=2)+
  annotate("text", x=-110.989,y=32.468,label="Stone Canyon Club",colour="white",size=3)+
  # scalebar(x.min = -111.005, x.max = -110.975,
  #         y.min = 32.455, y.max = 32.480, anchor = NULL,
  #          dist = 50, transform=TRUE,dist_unit="m", model = 'WGS84')+
  labs(title = "Stone Canyon Study Site Oro Valley Arizona")
```
Figure 1 | Stone Canyon Golf Club, located in Oro Valley, Arizona on the northern edge of Tucson, Arizona.

<br>

![StoneCanyon](picture1.png){width=300px}

<br>

For the comparison site, the unsubsidized natural population was represented using spatial data that was collected on 15 Gila Monsters, 6 males, 6 females and 3 sub-adults from 2000-2002 using radio-telemetry at Owl Head Buttes, Arizona. Located in Arizona upland Sonoran Desert approximately 19 km north northeast of Stone Canyon, the Owl Head Buttes study site was an area of approximately 200 hectares, with an elevation range of 800m-900m, and discontinuous southern buttes of rocky outcrops. Owl Head harbors no urbanized development or other human altered environments aside from highly spaced unpaved dirt access roads throughout the surrounding area. 

<br>

![OwlHead](picture2.png){width=300px}

<br>


```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
bioclim <- getData(name = "worldclim", res = 2.5, var = "bio", path = "./Data/")

names(bioclim) <- c("Ann Mean Temp","Mean Diurnal Range","Isothermality",
                    "Temperature Seasonality","Max Temp Warmest Mo","Min Temp Coldest Mo",
                    "Ann Temp Range","Mean Temp Wettest Qtr","Mean Temp Driest Qtr",
                    "Mean Temp Warmest Qtr","Mean Temp Coldest Qtr","Annual Precip",
                    "Precip Wettest Mo","Precip Driest Mo","Precip Seasonality",
                    "Precip Wettest Qtr","Precip Driest Qtr","Precip Warmest Qtr",
                    "Precip Coldest Qtr")

# bio_extent <- extent(x = c(
#   min(H.susp_xy$longitude),
#   max(H.susp_xy$longitude),
#   min(H.susp_xy$latitude),
#   max(H.susp_xy$latitude)))

bio_extent <- extent(x = c(
  min(-118),
  max(-105),
  min(30),
  max(40)))


bioclim_extent <- crop(x = bioclim, y = bio_extent)
bioclim_model <- bioclim(x = bioclim_extent, p = H.susp_xy)
presence_model <- dismo::predict(object = bioclim_model, 
                                 x = bioclim_extent, 
                                 ext = bio_extent)

# H.susp_info
gplot(presence_model) + 
  geom_raster(aes(fill=value)) +
  geom_polygon(data = us, aes(x= long, y = lat, group = group),
               fill = NA, color="black") +
  geom_point(data = H.susp_info, aes(x = longitude, y = latitude), color = "black", 
             alpha = 0.5) +
  scale_fill_gradientn(colours=c("brown","yellow","darkgreen"), "Probability") +
  coord_fixed(xlim = c(-117,-106), ylim = c(31,39)) +
  xlab("Longitude") + ylab("Latitude") + ggtitle("Probability of Gila Monster Occurrence") + 
  theme_bw() + theme(plot.title = element_text(hjust = 0.5)) + 
  theme(legend.position = "right")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank())
```





# Overall Yearly Home Ranges (MCP)

<span style="color:blue">Summary of home range size.</span>

```{r Home range sizes of Stone Canyon and Owl Head Buttes by year., message=FALSE, warning=FALSE, include=FALSE}
GM_table <- read_csv("GM_table.csv")
kable(GM_table,format="pandoc", caption='Table 1 | Pooled overall home ranges of Gila Monsters at Owl Head Buttes and Stone Canyon Golf Club. Both 100% and 95% MCPs were calculated between both populations.')
```

95% and 100% MCP estimates were used to assess overall and seasonal variation for comparisons between Owl Head and Stone Canyon. To explore potential infrequent exploratory movements as described by Burt’s (1943) definition of home range, such as mate searching by males, we used 95% MCPs. This can give an indication to the extent of a Gila Monsters home range that is potentially related to exploratory movements. Due the nature of our dataset we used Repeated Measures Analysis of Variance (RMANOVA) due to its reduced sensitivity to missing data and an unbalanced design. This method was performed for both 100% and 95% MCPs. For yearly home ranges, Mixed Effects RMANOVAs were performed to examine the effects of year, sex, and sample size. Post-Hoc pairwise comparisons were performed to assess where significant differences occurred.  

<br>


```{r}
All.Gilas <- read_csv("./GM_Final_Data.csv")

utm_points <- cbind(All.Gilas$EASTING, All.Gilas$NORTHING)

utm_locations <- SpatialPoints(utm_points, proj4string=CRS.SC)

proj_lat.lon <- as.data.frame(spTransform(utm_locations, CRS("+proj=longlat +datum=WGS84")))
colnames(proj_lat.lon) <- c("x","y")

## FORTIGY SPATIAL SPATIAL POINTS FOR PLOTTING:
proj_lat.lon <- fortify(proj_lat.lon, region = "Type")

myMap <- get_stamenmap(bbox = c(left = -111.009,
                                bottom = 32.459,
                                right = -110.969,
                                top = 32.474),
                       maptype = "terrain", 
                       crop = FALSE,
                       zoom = 15)

ggmap(myMap)+geom_point(data=proj_lat.lon, aes(x=x, y=y), size=0.3)
```
Figure 2 | Total relocations of 22 Gila Monsters throughout Stone Canyon for the entire study period.

<br>



## Overall Home Range Comparisons MCP. 

```{r Stone Canyon Vs. Owl Head Buttes, echo=FALSE, message=FALSE, warning=FALSE}
year <- read_csv("GM_Consolidated_ByYear.csv")

# quick plot
Graph1<-ggplot(year,aes(x=N100,y=Home_Range_100mcp,group=Environment))+
  geom_point(aes(shape = factor(Environment)), size = 2)+
  geom_smooth(method=lm)+
  # scale_colour_manual(values=c(subsidized="cyan3",nonsubsidized="indian red1"))+
  # labs(title = "100% MCP Home Ranges")+
  xlab("Number of Relocations")+
  ylab("Area (ha) using 100% MCP")+
  geom_smooth(method = "lm",se=FALSE)+
  labs(caption = "Figure 3 | Non-Subsidized (Owl Head Buttes) vs. Subsidized (Stone Canyon) population 100% MCPs against number \n of fixes of the complete data set.")+
  theme(plot.caption = element_text(hjust = 0,lineheight = 0.9))
  # theme_bw()

Graph1<-Graph1+theme(axis.title=element_text(size = 14))

# legend at top-left, inside the plot
SCOH.hr.fig<-Graph1 + theme(legend.title = element_blank(),
               legend.justification=c(0,1),
               legend.position=c(0.05, 0.95),
               legend.background = element_blank(),
               legend.key = element_blank(),
               legend.box.background = element_rect(colour = "black"))
SCOH.hr.fig
# dir.create("outputs") # create a new folder to hold the output files
# ggsave("outputs/SC_OHB_plot.pdf")
```

<br>

At Stone Canyon, home ranges appeared relatively stable, with no major shifts in areas of use (Fig. 4). Male yearly home ranges ranged from 1.91 - 25.1 ha, with a mean of 11.7 ± 1.7 S.E. ha (100% MCP), 9.1 ± 1.3 S.E. Ha (95% MCP). Female home ranges ranged from 2.1 – 38.8 ha and a mean of 9.8 ± 1.1 S.E. ha (100% MCP), 7.1 ± 0.7 S.E. ha (95% MCP). Male Gila Monsters at Owl head Buttes had home ranges that ranged from 10.6 – 82.7 ha with a mean of 43.2 ± 5.7 S.E. ha (100% MCP), 41.9 ± 4.9 S.E. ha (95% MCP). Female home ranges ranged from 7.1 – 47.6 with a mean of 22.0 ± 3.7 S.E. ha (100% MCP), 20.6 ± 2.5 S.E. ha (95% MCP).


```{r echo=FALSE, message=FALSE, warning=FALSE}
library(Rmisc)
Means <- summarySE(year, measurevar="Home_Range_100mcp",
                          groupvars=c("Environment"),na.rm = TRUE)

kable(Means, format = "pandoc", caption = 'Overall combined 100% MCP means averaged across sex')
```

```{r include=FALSE}
Means.95mcp <- summarySE(year, measurevar="Home_Range_95mcp",
                          groupvars=c("Environment"),na.rm = TRUE)
Means.95mcp
```


<br>


```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# mcp_analysis <- function(filename, percentage){
#   data <- read.csv(file = filename)
#   x <- as.data.frame(data$EASTING)
#   y <- as.data.frame(data$NORTHING)
#   xy <- c(x,y)
#   data.proj <- SpatialPointsDataFrame(xy,data, proj4string = CRS.SC)
#   xy <- SpatialPoints(data.proj@coords)
#   mcp.out <- mcp(xy, percentage, unout="ha")
#   area <- as.data.frame(round(mcp.out@data$area,4))
#   .rowNamesDF(area, make.names=TRUE) <- data$YEAR
#   write.table(area,file="MCP_Hectares.csv",
#               append=TRUE,sep=",", col.names=FALSE, row.names=TRUE)
#   mcp.points <- cbind((data.frame(xy)),data$YEAR)
#   colnames(mcp.points) <- c("x","y", "year")
#   mcp.poly <- fortify(mcp.out, region = "id")
#   units <- grid.text(paste(round(mcp.out@data$area,2)," ha"), x=0.9,  y=0.95,
#                      gp=gpar(fontface=4, cex=0.9), draw = FALSE)
#   mcp.plot <- ggplot() +
#     geom_polygon(data=mcp.poly, aes(x=mcp.poly$long, y=mcp.poly$lat), alpha=0.5) +
#     geom_point(data=mcp.points, aes(x=x, y=y)) + theme_bw() +
#     labs(x="Easting (m)", y="Northing (m)", title=mcp.points$year) +
#     theme(legend.position="none", plot.title = element_text(face = "bold", hjust = 0.5)) +
#     annotation_custom(units)
#   mcp.plot
# }

```


```{r echo=FALSE, message=FALSE, warning=FALSE}
CRS.SC<-CRS("+proj=utm +zone=12 +ellps=WGS84 +units=m +no_defs")

mcp_analysis.POLY <- function(filename, percentage){
  data <- read.csv(file = filename,stringsAsFactors = FALSE)
  data.sp <- data[, c("LIZARDNUMBER", "EASTING", "NORTHING")]
  coordinates(data.sp) <- c("EASTING", "NORTHING")
  proj4string(data.sp) <- CRS.SC
  mcp_out <- mcp(data.sp, percentage, unout="ha")
}

M215_mcp.11<-mcp_analysis.POLY("./M215/2011 .csv", percentage= 100)
M215_mcp.12<-mcp_analysis.POLY("./M215/2012 .csv", percentage= 100)
F104_mcp.08<-mcp_analysis.POLY("./F104/2008 .csv", percentage= 100)
F104_mcp.09<-mcp_analysis.POLY("./F104/2009 .csv", percentage= 100)
F114_mcp.08<-mcp_analysis.POLY("./F114/2008 .csv", percentage= 100)
F114_mcp.09<-mcp_analysis.POLY("./F114/2009 .csv", percentage= 100)
F114_mcp.10<-mcp_analysis.POLY("./F114/2010 .csv", percentage= 100)
F114_mcp.11<-mcp_analysis.POLY("./F114/2011 .csv", percentage= 100)
F114_mcp.12<-mcp_analysis.POLY("./F114/2012 .csv", percentage= 100)
F137_mcp.09<-mcp_analysis.POLY("./F137/2009 .csv", percentage= 100)
F137_mcp.10<-mcp_analysis.POLY("./F137/2010 .csv", percentage= 100)
F137_mcp.11<-mcp_analysis.POLY("./F137/2011 .csv", percentage= 100)
F147_mcp.09<-mcp_analysis.POLY("./F147/2009 .csv", percentage= 100)
F147_mcp.10<-mcp_analysis.POLY("./F147/2010 .csv", percentage= 100)
F147_mcp.11<-mcp_analysis.POLY("./F147/2011 .csv", percentage= 100)
F147_mcp.12<-mcp_analysis.POLY("./F147/2012 .csv", percentage= 100)
F36_mcp.08<-mcp_analysis.POLY("./F36/2008 .csv", percentage= 100)
F36_mcp.09<-mcp_analysis.POLY("./F36/2009 .csv", percentage= 100)
F36_mcp.10<-mcp_analysis.POLY("./F36/2010 .csv", percentage= 100)
F36_mcp.11<-mcp_analysis.POLY("./F36/2011 .csv", percentage= 100)
F36_mcp.12<-mcp_analysis.POLY("./F36/2012 .csv", percentage= 100)
F66_mcp.08<-mcp_analysis.POLY("./F66/2008 .csv", percentage= 100)
F66_mcp.09<-mcp_analysis.POLY("./F66/2009 .csv", percentage= 100)
F66_mcp.10<-mcp_analysis.POLY("./F66/2010 .csv", percentage= 100)
M119_mcp.08<-mcp_analysis.POLY("./M119/2008 .csv", percentage= 100)
M119_mcp.09<-mcp_analysis.POLY("./M119/2009 .csv", percentage= 100)
M119_mcp.10<-mcp_analysis.POLY("./M119/2010 .csv", percentage= 100)
M112_mcp.07<-mcp_analysis.POLY("./M112/2007 .csv", percentage= 100)
M112_mcp.09<-mcp_analysis.POLY("./M112/2009 .csv", percentage= 100)
M112_mcp.10<-mcp_analysis.POLY("./M112/2010 .csv", percentage= 100)
M69_mcp.09<-mcp_analysis.POLY("./M69/2009 .csv", percentage= 100)
M69_mcp.10<-mcp_analysis.POLY("./M69/2010 .csv", percentage= 100)

## Fortify mcp polygons for ggplot2 *YEAR*:
F104_mcp.08T <- fortify(F104_mcp.08, region = "id")
F104_mcp.09T <- fortify(F104_mcp.09, region = "id")
F114_mcp.08T <- fortify(F114_mcp.08, region = "id")
F114_mcp.09T <- fortify(F114_mcp.09, region = "id")
F114_mcp.10T <- fortify(F114_mcp.10, region = "id")
F114_mcp.11T <- fortify(F114_mcp.11, region = "id")
F114_mcp.12T <- fortify(F114_mcp.12, region = "id")
F137_mcp.09T <- fortify(F137_mcp.09, region = "id")
F137_mcp.10T <- fortify(F137_mcp.10, region = "id")
F137_mcp.11T <- fortify(F137_mcp.11, region = "id")
F147_mcp.09T <- fortify(F147_mcp.09, region = "id")
F147_mcp.10T <- fortify(F147_mcp.10, region = "id")
F147_mcp.11T <- fortify(F147_mcp.11, region = "id")
F147_mcp.12T <- fortify(F147_mcp.12, region = "id")
F36_mcp.08T <- fortify(F36_mcp.08, region = "id")
F36_mcp.09T <- fortify(F36_mcp.09, region = "id")
F36_mcp.10T <- fortify(F36_mcp.10, region = "id")
F36_mcp.11T <- fortify(F36_mcp.11, region = "id")
F36_mcp.12T <- fortify(F36_mcp.12, region = "id")
F66_mcp.08T <- fortify(F66_mcp.08, region = "id")
F66_mcp.09T <- fortify(F66_mcp.09, region = "id")
F66_mcp.10T <- fortify(F66_mcp.10, region = "id")
M119_mcp.08T <- fortify(M119_mcp.08, region = "id")
M119_mcp.09T <- fortify(M119_mcp.09, region = "id")
M119_mcp.10T <- fortify(M119_mcp.10, region = "id")
M112_mcp.07T <- fortify(M112_mcp.07, region = "id")
M112_mcp.09T <- fortify(M112_mcp.09, region = "id")
M112_mcp.10T <- fortify(M112_mcp.10, region = "id")
M69_mcp.09T <- fortify(M69_mcp.09, region = "id")
M69_mcp.10T <- fortify(M69_mcp.10, region = "id")
M215_mcp.11T <- fortify(M215_mcp.11, region = "id")
M215_mcp.12T <- fortify(M215_mcp.12, region = "id")


mcp.shift.TEST4 <- ggplot() +
  geom_polygon(data=F104_mcp.08T, aes(x=F104_mcp.08T$long, y=F104_mcp.08T$lat),
               alpha=0.1,colour="black",linetype=2) +
  geom_polygon(data=F104_mcp.09T, aes(x=F104_mcp.09T$long, y=F104_mcp.09T$lat),
               alpha=0.1,colour="black",linetype=2) +
  geom_polygon(data=F114_mcp.08T, aes(x=F114_mcp.08T$long, y=F114_mcp.08T$lat),
               alpha=0.1,colour="black",linetype=3) +
  geom_polygon(data=F114_mcp.09T, aes(x=F114_mcp.09T$long, y=F114_mcp.09T$lat),
               alpha=0.1,colour="black",linetype=3) +
  geom_polygon(data=F114_mcp.10T, aes(x=F114_mcp.10T$long, y=F114_mcp.10T$lat),
               alpha=0.1,colour="black",linetype=3) +
  geom_polygon(data=F114_mcp.11T, aes(x=F114_mcp.11T$long, y=F114_mcp.11T$lat),
               alpha=0.1,colour="black",linetype=3) +
  geom_polygon(data=F114_mcp.12T, aes(x=F114_mcp.12T$long, y=F114_mcp.12T$lat),
               alpha=0.1,colour="black",linetype=3) +
  geom_polygon(data=F137_mcp.09T, aes(x=F137_mcp.09T$long, y=F137_mcp.09T$lat),
               alpha=0.1,colour="black",linetype=4) +
  geom_polygon(data=F137_mcp.10T, aes(x=F137_mcp.10T$long, y=F137_mcp.10T$lat),
               alpha=0.1,colour="black",linetype=4) +
  geom_polygon(data=F137_mcp.11T, aes(x=F137_mcp.11T$long, y=F137_mcp.11T$lat),
               alpha=0.1,colour="black",linetype=4) +
  geom_polygon(data=F147_mcp.09T, aes(x=F147_mcp.09T$long, y=F147_mcp.09T$lat),
               alpha=0.1,colour="red",linetype=1) +
  geom_polygon(data=F147_mcp.10T, aes(x=F147_mcp.10T$long, y=F147_mcp.10T$lat),
               alpha=0.1,colour="red",linetype=1) +
  geom_polygon(data=F147_mcp.11T, aes(x=F147_mcp.11T$long, y=F147_mcp.11T$lat),
               alpha=0.1,colour="red",linetype=1) +
  geom_polygon(data=F147_mcp.12T, aes(x=F147_mcp.12T$long, y=F147_mcp.12T$lat),
               alpha=0.1,colour="red",linetype=1) +
  geom_polygon(data=F36_mcp.08T, aes(x=F36_mcp.08T$long, y=F36_mcp.08T$lat),
               alpha=0.1,colour="black",linetype=6) +
  geom_polygon(data=F36_mcp.09T, aes(x=F36_mcp.09T$long, y=F36_mcp.09T$lat),
               alpha=0.1,colour="black",linetype=6) +
  geom_polygon(data=F36_mcp.10T, aes(x=F36_mcp.10T$long, y=F36_mcp.10T$lat),
               alpha=0.1,colour="black",linetype=6) +
  geom_polygon(data=F36_mcp.11T, aes(x=F36_mcp.11T$long, y=F36_mcp.11T$lat),
               alpha=0.1,colour="black",linetype=6) +
  geom_polygon(data=F36_mcp.12T, aes(x=F36_mcp.12T$long, y=F36_mcp.12T$lat),
               alpha=0.1,colour="black",linetype=6) +
  geom_polygon(data=F66_mcp.08T, aes(x=F66_mcp.08T$long, y=F66_mcp.08T$lat),
               alpha=0.1,colour="black",linetype=1) +
  geom_polygon(data=F66_mcp.09T, aes(x=F66_mcp.09T$long, y=F66_mcp.09T$lat),
               alpha=0.1,colour="black",linetype=1) +
  geom_polygon(data=F66_mcp.10T, aes(x=F66_mcp.10T$long, y=F66_mcp.10T$lat),
               alpha=0.1,colour="black",linetype=1) +
  geom_polygon(data=M119_mcp.08T, aes(x=M119_mcp.08T$long, y=M119_mcp.08T$lat),
               alpha=0.1,colour="blue",linetype=2) +
  geom_polygon(data=M119_mcp.09T, aes(x=M119_mcp.09T$long, y=M119_mcp.09T$lat),
               alpha=0.1,colour="blue",linetype=2) +
  geom_polygon(data=M119_mcp.10T, aes(x=M119_mcp.10T$long, y=M119_mcp.10T$lat),
               alpha=0.1,colour="blue",linetype=2) +
  geom_polygon(data=M112_mcp.07T, aes(x=M112_mcp.07T$long, y=M112_mcp.07T$lat),
               alpha=0.1,colour="blue",linetype=3) +
  geom_polygon(data=M112_mcp.09T, aes(x=M112_mcp.09T$long, y=M112_mcp.09T$lat),
               alpha=0.1,colour="blue",linetype=3) +
  geom_polygon(data=M112_mcp.10T, aes(x=M112_mcp.10T$long, y=M112_mcp.10T$lat),
               alpha=0.1,colour="blue",linetype=3) +
  # geom_polygon(data=M69_mcp.09T, aes(x=M69_mcp.09T$long, y=M69_mcp.09T$lat),
  #              alpha=0.1,colour="black") +
  # geom_polygon(data=M69_mcp.10T, aes(x=M69_mcp.10T$long, y=M69_mcp.10T$lat),
  #              alpha=0.1,colour="black") +
  # geom_polygon(data=M215_mcp.11T, aes(x=M215_mcp.11T$long, y=M215_mcp.11T$lat),
  #              alpha=0.1,colour="black") +
  # geom_polygon(data=M215_mcp.12T, aes(x=M215_mcp.12T$long, y=M215_mcp.12T$lat),
  #              alpha=0.1,colour="black") +
  theme_bw() +labs(x="Easting (m)", y="Northing (m)") +
  labs(caption = "Figure 4  |  Yearly home range shifts of sub-sampled home ranges of 8 lizards, both males and females. Home \n range shifts appear to be relativley stable over study years.")+
  theme(plot.caption = element_text(hjust = 0,lineheight = 0.9))
  # theme(legend.position="none", plot.title = element_text(face = "bold", hjust = 0.5))
## within each geom_polygon line?:
## aes(colour="red"or"M112_mcp.09T")...+scale_color_manual(name="",breaks=c("","",...""))+
## values=c(""="",...)

mcp.shift.TEST4
```

<br>

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(Rmisc)
YR_GRP_Means <- summarySE(year, measurevar="Home_Range_100mcp",
                          groupvars=c("Environment","Sex"),na.rm = TRUE)

kable(YR_GRP_Means, format = "pandoc", 
      caption = 'Table 1 | Raw group 100% MCP home range means of Stone Canyon and Owl Head Buttes. Grouped by environment and sex.')
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
YR_GRP_Means95 <- summarySE(year, measurevar="Home_Range_95mcp",
                            groupvars=c("Environment","Sex"),na.rm = TRUE)

kable(YR_GRP_Means95, format = "pandoc", caption = 'Table 2 | Raw group 95% MCP home range means of raw data of Stone Canyon and Owl Head Buttes. Grouped by environment and sex.')
```


<br>


  In the analyses of both populations, year had no effect on 100% MCP home range sizes (F = 0.41, P = 0.52), while there was a detected significant difference in home ranges between the two populations (F = 8.69, P = 0.004), as well as sex (F = 16.33, P = 0.0004). 

<br>

<span style="color:blue">Repeated measures ANOVA for Yearly Home Ranges.</span>

```{r RMANOVA YEARLY OVERALL 100%MCP, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# Get p-values from mixed model F values:
library(lme4)
library(readr)
year <- read_csv("GM_Consolidated_ByYear.csv")

RMmod.year<-lmer(Home_Range_100mcp~Environment+Year+Sex+N100+Environment*Sex+
                   (1|Gila),data = year)
summary(RMmod.year)
```



ANOVA Table: 100% MCP
```{r echo=FALSE, message=FALSE, warning=FALSE}
anova(RMmod.year)
```

<br>

When using 95% MCPs, male home ranges reduced by 25% and female range by 31%. At Owl Head Buttes, Gila Monsters showed a similar behavior with male home ranges reduced by 20% and female ranges reduced by 26% using 95% MCPs. The affect of sample size was also removed in the 95% MCP analysis. Since there was no indication for major exploritory movements exhibited among males, and similar patterns observed among the Owl Head population, 100% MCPs were used for further analyses. 

<br>

```{r RMANOVA YEARLY OVERALL 95% MCP, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
RMmod.year95<-lmer(Home_Range_95mcp~Environment+Year+Sex+N100+Environment*Sex+
                   (1|Gila),data = year)
summary(RMmod.year95)
```



ANOVA Table: 95% MCP
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
anova(RMmod.year95)
```


                                                                                            

 
                                                                                  
```{r Raw and EMMeans of Yearly Overall 100%MCP, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
RMmod.year100<-lmer(Home_Range_100mcp~Environment+Year+Sex+N100+Environment*Sex+(1|Gila),data = year)

RM.marginal <- lsmeans(RMmod.year100, 
                    ~ Environment)
# RM.marginal

## CATAGORIZE LSM GRAPH BY SEX BETWEEN ENVIRONMENT:
refRM_sex <- lsmeans(RMmod.year100, specs = c("Environment","Sex"))

# refRM_sex
ref_dfRM_sex <- as.data.frame(summary(refRM_sex))
pd_RM <- position_dodge(0.1)

yr.mean.adj<-ggplot(ref_dfRM_sex, aes(x=Sex,y=lsmean,group=Environment))+
  geom_point(aes(shape = factor(Environment)), size = 2,position=position_dodge(.1), 
            show.legend = FALSE)+
  geom_errorbar(aes(ymin=lsmean-SE, ymax=lsmean+SE), width=.1,position=position_dodge())+
  # ggtitle("Adjusted Home Ranges by Sex and Population (100% MCP)")+
  xlab("Sex")+
  ylab("")
  # labs(caption = "Figure 5  |  Adjusted home ranges using 100% MCPs between sexes of non-subsidized and subsidized populations. \n Adjusted for environment, year, sex, and sample size. Male home ranges remained smaller than those of females at \n Owl Head Buttes.")+
  # theme(plot.caption = element_text(hjust = 0,lineheight = 0.9))
  # theme(plot.title = element_text(hjust = 0.5, color="black", size=14, face="bold"))

# yr.mean.adj<-yr.mean.adj + theme(legend.title = element_blank(),
#                      legend.justification=c(0,1),
#                      legend.position=c(0.05, 0.95),
#                      legend.background = element_blank(),
#                      legend.key = element_blank(),
#                      legend.box.background = element_rect(colour = "black"))
# yr.mean.adj
# rm(LSM.YearHR)

pd_RM <- position_dodge(0.1)

Raw.YearHR<-ggplot(YR_GRP_Means, aes(x=Sex,y=Home_Range_100mcp,group=Environment))+
  geom_point(aes(shape = factor(Environment)), size = 2,position=position_dodge(.1))+
  geom_errorbar(aes(ymin=Home_Range_100mcp-se, ymax=Home_Range_100mcp+se),
                width=.1,position=position_dodge())+
  # ggtitle("Overall Home Ranges by Sex and Population (100% MCP)")+
  xlab("Sex")+
  ylab("100% MCP Area (ha)")
  # theme(plot.title = element_text(hjust = 0.5, color="black", size=14, face="bold"))
  # labs(caption = "Figure 3 | Raw overall mean home ranges between environment and sex using 100% MCPs. Note, that before adjusted \n home ranges, males exhibit smaller overall home ranges at Stone Canyon, than males of Owl Head Buttes.")+
  # theme(plot.caption = element_text(hjust = 0,lineheight = 0.9))

yr.mean.raw<-Raw.YearHR + theme(legend.title = element_blank(),
                     legend.justification=c(0,1),
                     legend.position=c(0.05, 0.95),
                     legend.background = element_blank(),
                     legend.key = element_blank(),
                     legend.box.background = element_rect(colour = "black"))
# yr.mean.raw

library(gridExtra)
library(grid)

grid.arrange(yr.mean.raw, yr.mean.adj, nrow = 1,  
             bottom = textGrob("Figure 5 | a. Raw group means of overall yearly home ranges between males and females. Note that the male \n home range of the subsidized population is smaller than that of the female home range in the non-subsidized \n population. b. Group means of home ranges after being adjusted for environment, year, sex, and sample size.",
                               gp = gpar(fontface = 1,fontsize = 10),hjust = 0, x = 0))
```


<br>


```{r echo=FALSE, message=FALSE, warning=FALSE}
kable(ref_dfRM_sex, format = "pandoc", caption = 'Table 3 | Directional means of home range (100% MCP) after being adjusted for year, sex and sample size.')
```

<br>
                                                                                            
### Post-Hoc comparisons between sexes and environment 100% MCP:

Post-Hoc analyses between sexes indicated that there was a significant difference in male home ranges between the two environments (df = 68.3, P = 0.001). There was a slight difference of female home ranges between the two environments, however it was not statistically significant (df = 68.7, P = 0.07). At stone canyon there was no major difference between male and female home ranges (df = 31.8, P = 0.16) with male home range being only 3% larger than females. Males at Owl Head Buttes had a 65% larger home range than did females, and was statistically significant (df = 31.6, P = 0.0003). Interestingly, males at Stone Canyon had smaller home ranges than did the females at Owl Head Buttes (Table x). 

<br>

```{r Comps for Sex, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
RMmod.year.Em<-lmer(Home_Range_100mcp~Environment+Year+Sex+N100+Environment*Sex+
                      (1|Gila),data = year)

# RMmod.year.Em95<-lmer(Home_Range_95mcp~Environment+Year+Sex+N95+Environment*Sex+
#                       (1|Gila),data = year)

# Sex.emm.oa <- emmeans(RMmod.year.Em, c("Environment","Sex"))
# pairs(Sex.emm.oa)

emm_s.t2 <- emmeans(RMmod.year.Em, pairwise ~ Sex | Environment)
emm_s.t2
# emm_s.e1 <- emmeans(RMmod.year.Em, pairwise ~ Environment)
# emm_s.e1
```



Graphical Comparisons of Sex Within Each Environment:
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot(emm_s.t2, comparisons = TRUE, xlab = "Least Square Mean (ha)", ylab = "Environment")
```
Figure 6 | Pairwise comparisons of home range between sexes within each environment. If red arrows overlap those of others, then  there is no significant statistical difference. 

<br>

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
emm_s.t3 <- emmeans(RMmod.year.Em, pairwise ~ Environment | Sex)
emm_s.t3

# emm_s.t95 <- emmeans(RMmod.year.Em95, pairwise ~ Environment | Sex)
# emm_s.t95
```



Graphical Comparisons of Sex between the two populations:
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot(emm_s.t3, comparisons = TRUE, xlab = "Least Square Mean (ha)", ylab = "Environment")
```
Figure 7 | Pairwise comparisons of sex between environments. If red arrows overlap those of others, then there is no significant statistical difference. 


<br>
 

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

mcp_analysis.POLY <- function(filename, percentage){
  data <- read.csv(file = filename,stringsAsFactors = FALSE)
  data.sp <- data[, c("LIZARDNUMBER", "EASTING", "NORTHING")]
  coordinates(data.sp) <- c("EASTING", "NORTHING")
  proj4string(data.sp) <- CRS.SC
  mcp_out <- mcp(data.sp, percentage, unout="ha")
}

M67_MCP<-mcp_analysis.POLY('./M67/M67 .csv', percentage= 100)
M69_MCP<-mcp_analysis.POLY('./M69/M69 .csv', percentage= 100)
M255_MCP<-mcp_analysis.POLY('./M255/M255 .csv', percentage= 100)
M215_MCP<-mcp_analysis.POLY('./M215/M215 .csv', percentage= 100)
M14_MCP<-mcp_analysis.POLY('./M14/M14 .csv', percentage= 100)
M119_MCP<-mcp_analysis.POLY('./M119/M119 .csv', percentage= 100)
M112_MCP<-mcp_analysis.POLY('./M112/M112 .csv', percentage= 100)

F66_MCP<-mcp_analysis.POLY('./F66/F66 .csv', percentage= 100)
F36_MCP<-mcp_analysis.POLY('./F36/F36 .csv', percentage= 100)
F252_MCP<-mcp_analysis.POLY('./F252/F252 .csv', percentage= 100)
F214_MCP<-mcp_analysis.POLY('./F214/F214 .csv', percentage= 100)
F200_MCP<-mcp_analysis.POLY('./F200/F200 .csv', percentage= 100)
F147_MCP<-mcp_analysis.POLY('./F147/F147 .csv', percentage= 100)
F146_MCP<-mcp_analysis.POLY('./F146/F146 .csv', percentage= 100)
F137_MCP<-mcp_analysis.POLY('./F137/F137 .csv', percentage= 100)
F135_MCP<-mcp_analysis.POLY('./F135/F135 .csv', percentage= 100)
F114_MCP<-mcp_analysis.POLY('./F114/F114 .csv', percentage= 100)
F104_MCP<-mcp_analysis.POLY('./F104/F104 .csv', percentage= 100)

Male.MCP <- rbind(M67_MCP,M69_MCP,M255_MCP,M215_MCP,M14_MCP,M119_MCP,M112_MCP)
Female.MCP <- rbind(F66_MCP,F36_MCP,F252_MCP,F214_MCP,F200_MCP,F147_MCP,F146_MCP,F137_MCP,
                    F135_MCP,F114_MCP,F104_MCP)

mapviewOptions(basemaps = c("OpenStreetMap","Esri.WorldImagery","OpenTopoMap"),
               na.color = "magenta",
               layers.control.pos = "topleft")

mapview(Male.MCP, legend=F, zcol="id", col.regions = c("blue"), alpha.regions=0.3) + 
  mapview(Female.MCP, legend=F, zcol = "id", col.regions = c("red"), alpha.regions=0.3)
```
Figure 8 | Interactive map: Home Range overlap by sex of 100% MCPs at Stone Canyon. Red polygons represent female lizards, and blue represents male lizards. 


<br>


## Overall Home Range Comparisons KDE:


Home range estimation on the Stone Canyon Gila Monsters using 95% KDEs with href bandwidth produced male home ranges ranging from 14.5 – 55.3 ha with a mean of 35.0 ± 3.1 S.E. ha. Female home ranges ranged from 10.1 – 47.8 ha with a mean of 23.0 ± 1.8 S.E. KDE estimates for male and female home ranges were 96% and 80% larger respectively than MCP estimates. Repeated Measures analysis of KDEs suggested that there was a significant difference between male and female home ranges at Stone Canyon (F = 8.88, P = 0.008). There was not an affect of year on home ranges (F = 0.59, P = 0.44). 

<br>


```{r message=FALSE, warning=FALSE, include=FALSE}
year.kde<-read_csv('yearly kde table.csv')
kable(year.kde, format = "pandoc", caption = 'Yearly KDE Home Ranges')
```




```{r echo=FALSE, message=FALSE, warning=FALSE}
sub <- subset(year, Environment == "subsidized")

YR_GRP_Means.95KDE <- summarySE(sub, measurevar="Home_Range_95kde",
                            groupvars=c("Sex"),na.rm = TRUE)

kable(YR_GRP_Means.95KDE, format = "pandoc", caption = 'Table 4 | Raw Group 95% KDE home range means male and female home ranges at Stone Canyon.')
```
 
<br>
 
<span style="color:blue">Repeated measures ANOVA for KDE Home Ranges.</span>


```{r Repeated Measures ANOVA KDE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# Get p-values from mixed model F values:

RM.KDEmod.year<-lmer(Home_Range_95kde~Year+Sex+N+(1|Gila),data = sub)

summary(RM.KDEmod.year)
```
 
ANOVA Table for 95% KDE (subsidized)
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
anova(RM.KDEmod.year)
```

<br>

Male 50% KDE home ranges ranges averaged 9.0 ± 0.8 S.E. ha., female home ranges averaged 5.6 ± 0.5 S.E. Repeated Measures analysis of 50% KDEs suggested that there was still a significant difference between male and female home ranges at Stone Canyon (F = 6.36, P = 0.01). There was not an affect of year on home ranges (F = 0.06, P = 0.79). 

<br>

```{r Repeated Measures ANOVA50% KDE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# Get p-values from mixed model F values:

RM.KDE.50.mod.year<-lmer(Home_Range_50kde~Year+Sex+N+(1|Gila),data = sub)

summary(RM.KDE.50.mod.year)
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
YR_GRP_Means.50KDE <- summarySE(sub, measurevar="Home_Range_50kde",
                            groupvars=c("Sex"),na.rm = TRUE)

kable(YR_GRP_Means.50KDE, format = "pandoc", caption = 'Table 5 | Raw Group 50% KDE home range means male and female home ranges at Stone Canyon.')
```


ANOVA Table for 50% KDE (subsidized)
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
anova(RM.KDE.50.mod.year)
```
 
 

 
 
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(gridExtra)
library(grid)

Raw.KDE.HR<-ggplot(YR_GRP_Means.95KDE, aes(x=Sex,y=Home_Range_95kde))+
  geom_point(size = 2, position=position_dodge(.1))+
  geom_errorbar(aes(ymin=Home_Range_95kde-se, ymax=Home_Range_95kde+se),
                width=.1,position=position_dodge())+
  # ggtitle("Overall Home Ranges by Sex and Population (100% MCP)")+
  xlab("Sex")+
  ylab("95% KDE Area (ha)")+
   # labs(caption = "Figure 8  |  Raw 95% KDE home ranges between male and female home ranges at Stone Canyon.")+
  theme(plot.caption = element_text(hjust = 0,lineheight = 0.9))
  # theme(plot.title = element_text(hjust = 0.5, color="black", size=14, face="bold"))

Raw.KDE.HR<-Raw.KDE.HR + theme(legend.title = element_blank(),
                     legend.justification=c(0,1),
                     legend.position=c(0.05, 0.95),
                     legend.background = element_blank(),
                     legend.key = element_blank(),
                     legend.box.background = element_rect(colour = "black"))
Raw.KDE.HR

RM.KDEmod.year<-lmer(Home_Range_95kde~Year+Sex+N+(1|Gila),data = sub)

KDE.marginal <- lsmeans(RM.KDEmod.year, 
                    ~ Sex)
# RM.marginal

## CATAGORIZE LSM GRAPH BY SEX BETWEEN ENVIRONMENT:
refRM_KDE <- lsmeans(RM.KDEmod.year, specs = c("Sex"))

# refRM_sex
ref_dfRM_KDE <- as.data.frame(summary(refRM_KDE))
pd_RM <- position_dodge(0.1)

LSM.KDE.HR<-ggplot(ref_dfRM_KDE, aes(x=Sex,y=lsmean))+
  geom_point(size = 2,position=position_dodge(.1))+
  geom_errorbar(aes(ymin=lsmean-SE, ymax=lsmean+SE), width=.1,position=position_dodge())+
  # ggtitle("Adjusted Home Ranges by Sex and Population (100% MCP)")+
  xlab("Sex")+
  ylab("")
  # labs(caption = "Figure 8  |  Adjusted 95% KDE home ranges between male and femal home ranges at Stone Canyon. Adjusted on year, \n sex, and sample size.")+
  # theme(plot.caption = element_text(hjust = 0,lineheight = 0.9))
  # theme(plot.title = element_text(hjust = 0.5, color="black", size=14, face="bold"))

# LSM.KDE.HR<-LSM.KDE.HR + theme(legend.title = element_blank(),
#                      legend.justification=c(0,1),
#                      legend.position=c(0.05, 0.95),
#                      legend.background = element_blank(),
#                      legend.key = element_blank(),
#                      legend.box.background = element_rect(colour = "black"))
# LSM.KDE.HR

grid.arrange(Raw.KDE.HR, LSM.KDE.HR, nrow = 1,  
             bottom = textGrob("Figure 9 | a. Raw group means of overall yearly 95% KDEs between males and females at Stone Canyon. \n b. Adjusted 95% KDEs after being adjusted for  year, sex, and sample size.", gp = gpar(fontface = 1,fontsize = 10),hjust = 0, x = 0))
```

 
<br>
 


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

kde_analysis.href.polygon <- function(filename, percentage){
  data <- read.csv(file = filename,stringsAsFactors = FALSE)
  data.sp <- data[, c("LIZARDNUMBER", "EASTING", "NORTHING")]
  coordinates(data.sp) <- c("EASTING", "NORTHING")
  proj4string(data.sp) <- CRS.SC
  kde<-kernelUD(data.sp, h="href", kern="bivnorm", grid=1000)
  ver <- getverticeshr(kde, percentage)
  ver@proj4string<-CRS.SC
  ver
}

M67_KDE<-kde_analysis.href.polygon('./M67/M67 .csv', percentage= 95)
M69_KDE<-kde_analysis.href.polygon('./M69/M69 .csv', percentage= 95)
M255_KDE<-kde_analysis.href.polygon('./M255/M255 .csv', percentage= 95)
M215_KDE<-kde_analysis.href.polygon('./M215/M215 .csv', percentage= 95)
M14_KDE<-kde_analysis.href.polygon('./M14/M14 .csv', percentage= 95)
M119_KDE<-kde_analysis.href.polygon('./M119/M119 .csv', percentage= 95)
M112_KDE<-kde_analysis.href.polygon('./M112/M112 .csv', percentage= 95)

F66_KDE<-kde_analysis.href.polygon('./F66/F66 .csv', percentage= 95)
F36_KDE<-kde_analysis.href.polygon('./F36/F36 .csv', percentage= 95)
F252_KDE<-kde_analysis.href.polygon('./F252/F252 .csv', percentage= 95)
F214_KDE<-kde_analysis.href.polygon('./F214/F214 .csv', percentage= 95)
F200_KDE<-kde_analysis.href.polygon('./F200/F200 .csv', percentage= 95)
F147_KDE<-kde_analysis.href.polygon('./F147/F147 .csv', percentage= 95)
F146_KDE<-kde_analysis.href.polygon('./F146/F146 .csv', percentage= 95)
F137_KDE<-kde_analysis.href.polygon('./F137/F137 .csv', percentage= 95)
F135_KDE<-kde_analysis.href.polygon('./F135/F135 .csv', percentage= 95)
F114_KDE<-kde_analysis.href.polygon('./F114/F114 .csv', percentage= 95)
F104_KDE<-kde_analysis.href.polygon('./F104/F104 .csv', percentage= 95)

Male.KDE <- rbind(M67_KDE,M69_KDE,M255_KDE,M215_KDE,M14_KDE,M119_KDE,M112_KDE)
Female.KDE <- rbind(F66_KDE,F36_KDE,F252_KDE,F214_KDE,F200_KDE,F147_KDE,F146_KDE,F137_KDE,
                    F135_KDE,F114_KDE,F104_KDE)

mapviewOptions(basemaps = c("OpenStreetMap","Esri.WorldImagery","OpenTopoMap"),
               na.color = "magenta",
               layers.control.pos = "topleft")

mapview(Male.KDE, legend=F, zcol="id", col.regions = c("blue"), alpha.regions=0.3) + 
  mapview(Female.KDE, legend=F, zcol = "id", col.regions = c("red"), alpha.regions=0.3)
```
Figure 10 | Interactive map: Home Range overlap by sex of 95% KDEs at Stone Canyon. Red polygons represent female lizards, and blue represents male lizards. 

<br>


```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
kable(ref_dfRM_KDE, format = "pandoc", caption = 'Table  | Directional means of KDE home ranges after being adjusted for year, sex and sample size.')
```
 

# Seasonal Home Range

Seasons were categorized based on criteria that were both ecologically applicable to Gila Monsters and comparable to other studies. Five distinct ecologically relevant “seasons” were used to characterize Gila Monster activity patterns: winter, emergence, dry, monsoon, and post-monsoon. The winter season was characterized by an inconspicuous interval of inactivity at a single location. This location was assumed to be an overwintering refuge which are typically burrows under rocks within rocky buttes in proximity of reach in an animal’s range of activity. Emergence is marked by an increase of activity when the lizards emerge from their winter refuges. During this time of increased activity, movements are often over short distances and are relatively infrequent. Based on the activity patterns of animals within buttes at Owl Head, the end of the emergence season was marked when animals migrated to the desert flats. This movement is often presumed to be a response due to environmental cues. Stone Canyon does not possess buttes, and due to the relative habitat homogeneity of rocky outcrops throughout the golf course, animal “migration” or movements in response to environmental cues are a bit more inconspicuous. The end of emergence at Stone Canyon was based on a pronounced increase in animal movements over greater distances and frequency. Over the entire study period between both environments, the emergence season ranged from March 13th through April 16th. The dry season was defined starting at the end of emergence through the onset of the monsoon season. The dry season interval for both environments across both study periods was April 2nd through July 18th. The monsoon season is officially defined by the National Weather Service starting June 15th and ending September 30th. However, this seasonal time interval is ecologically irreverent to Gila Monsters. Gila Monster activity is triggered by environmental cues, and since the monsoon rains vary across years, the categorization of the monsoon season should be modified to reflect the ecological start date to which Gila Monsters will be sensitive. The monsoon season was determined by using NOAA adjusted monsoon dates, which starts on the first day when the average of dew point temperatures was greater than 55 degrees Fahrenheit across three consecutive days and ending on September 30th. The monsoon interval for both environments throughout the study period ranged from June 17th through September 30th. The post-monsoon season affectively marks the transition from the monsoon to the winter seasons, during which Gila Monster activity is largely reduced to smaller scale movements and tend to be reduced to smaller ranges within proximity of previous hibernacula. Post-monsoon season extends from the end of the monsoon (September 30th) to the winter months when Gila Monster activity essentially ceases at a single location. For both environments throughout each study period, the post-monsoon ranged from October 1st through December 14th.

Scaling home range analyses by seasonal estimates reduces the number of locations for each lizard. 100% MCPs were used for seasonal home range analyses to avoid any further reduction of locations for each estimation. For seasonal variation in home range sizes, a Mixed Effects RMANOVA was performed to examine the effects of year. Post-Hoc pairwise comparisons using Tukey adjusted p-values were performed examine where significant differences took place. 

<br>

```{r echo=FALSE, message=FALSE, warning=FALSE}
## Create MCP polygons by SEASON:
M215_mcp.EM<-mcp_analysis.POLY("./M215/Emergence .csv", percentage= 100)
M215_mcp.DRY<-mcp_analysis.POLY("./M215/Dry .csv", percentage= 100)
M215_mcp.MON<-mcp_analysis.POLY("./M215/Monsoon .csv", percentage= 100)

M112_mcp.DRY<-mcp_analysis.POLY("./M112/Dry .csv", percentage= 100)
M112_mcp.MON<-mcp_analysis.POLY("./M112/Monsoon .csv", percentage= 100)
M112_mcp.PM<-mcp_analysis.POLY("./M112/Post_Monsoon .csv", percentage= 100)

M119_mcp.DRY<-mcp_analysis.POLY("./M119/Dry .csv", percentage= 100)
M119_mcp.MON<-mcp_analysis.POLY("./M119/Monsoon .csv", percentage= 100)
M119_mcp.PM<-mcp_analysis.POLY("./M119/Post_Monsoon .csv", percentage= 100)

F114_mcp.EM<-mcp_analysis.POLY("./F114/Emergence .csv", percentage= 100)
F114_mcp.DRY<-mcp_analysis.POLY("./F114/Dry .csv", percentage= 100)
F114_mcp.MON<-mcp_analysis.POLY("./F114/Monsoon .csv", percentage= 100)
F114_mcp.PM<-mcp_analysis.POLY("./F114/Post_Monsoon .csv", percentage= 100)

F137_mcp.EM<-mcp_analysis.POLY("./F137/Emergence .csv", percentage= 100)
F137_mcp.DRY<-mcp_analysis.POLY("./F137/Dry .csv", percentage= 100)
F137_mcp.MON<-mcp_analysis.POLY("./F137/Monsoon .csv", percentage= 100)
F137_mcp.PM<-mcp_analysis.POLY("./F137/Post_Monsoon .csv", percentage= 100)

F147_mcp.EM<-mcp_analysis.POLY("./F147/Emergence .csv", percentage= 100)
F147_mcp.DRY<-mcp_analysis.POLY("./F147/Dry .csv", percentage= 100)
F147_mcp.MON<-mcp_analysis.POLY("./F147/Monsoon .csv", percentage= 100)
F147_mcp.PM<-mcp_analysis.POLY("./F147/Post_Monsoon .csv", percentage= 100)

F252_mcp.EM<-mcp_analysis.POLY("./F252/Emergence .csv", percentage= 100)
F252_mcp.DRY<-mcp_analysis.POLY("./F252/Dry .csv", percentage= 100)
F252_mcp.MON<-mcp_analysis.POLY("./F252/Monsoon .csv", percentage= 100)
F252_mcp.PM<-mcp_analysis.POLY("./F252/Post_Monsoon .csv", percentage= 100)

F36_mcp.EM<-mcp_analysis.POLY("./F36/Emergence .csv", percentage= 100)
F36_mcp.DRY<-mcp_analysis.POLY("./F36/Dry .csv", percentage= 100)
F36_mcp.MON<-mcp_analysis.POLY("./F36/Monsoon .csv", percentage= 100)
F36_mcp.PM<-mcp_analysis.POLY("./F36/Post_Monsoon .csv", percentage= 100)

F66_mcp.EM<-mcp_analysis.POLY("./F66/Emergence .csv", percentage= 100)
F66_mcp.DRY<-mcp_analysis.POLY("./F66/Dry .csv", percentage= 100)
F66_mcp.MON<-mcp_analysis.POLY("./F66/Monsoon .csv", percentage= 100)
F66_mcp.PM<-mcp_analysis.POLY("./F66/Post_Monsoon .csv", percentage= 100)

## Fortify mcp polygons for ggplot2 *SEASON*:
M215_mcp.EMT <- fortify(M215_mcp.EM, region = "id")
M215_mcp.DRYT <- fortify(M215_mcp.DRY, region = "id")
M215_mcp.MONT <- fortify(M215_mcp.MON, region = "id")

M112_mcp.DRYT <- fortify(M112_mcp.DRY, region = "id")
M112_mcp.MONT <- fortify(M112_mcp.MON, region = "id")
M112_mcp.PMT <- fortify(M112_mcp.PM, region = "id")

M119_mcp.DRYT <- fortify(M119_mcp.DRY, region = "id")
M119_mcp.MONT <- fortify(M119_mcp.MON, region = "id")
M119_mcp.PMT <- fortify(M119_mcp.PM, region = "id")

F114_mcp.EMT <- fortify(F114_mcp.EM, region = "id")
F114_mcp.DRYT <- fortify(F114_mcp.DRY, region = "id")
F114_mcp.MONT <- fortify(F114_mcp.MON, region = "id")
F114_mcp.PMT <- fortify(F114_mcp.PM, region = "id")

F137_mcp.EMT <- fortify(F137_mcp.EM, region = "id")
F137_mcp.DRYT <- fortify(F137_mcp.DRY, region = "id")
F137_mcp.MONT <- fortify(F137_mcp.MON, region = "id")
F137_mcp.PMT <- fortify(F137_mcp.PM, region = "id")

F147_mcp.EMT <- fortify(F147_mcp.EM, region = "id")
F147_mcp.DRYT <- fortify(F147_mcp.DRY, region = "id")
F147_mcp.MONT <- fortify(F147_mcp.MON, region = "id")
F147_mcp.PMT <- fortify(F147_mcp.PM, region = "id")

F252_mcp.EMT <- fortify(F252_mcp.EM, region = "id")
F252_mcp.DRYT <- fortify(F252_mcp.DRY, region = "id")
F252_mcp.MONT <- fortify(F252_mcp.MON, region = "id")
F252_mcp.PMT <- fortify(F252_mcp.PM, region = "id")

F36_mcp.EMT <- fortify(F36_mcp.EM, region = "id")
F36_mcp.DRYT <- fortify(F36_mcp.DRY, region = "id")
F36_mcp.MONT <- fortify(F36_mcp.MON, region = "id")
F36_mcp.PMT <- fortify(F36_mcp.PM, region = "id")

F66_mcp.EMT <- fortify(F66_mcp.EM, region = "id")
F66_mcp.DRYT <- fortify(F66_mcp.DRY, region = "id")
F66_mcp.MONT <- fortify(F66_mcp.MON, region = "id")
F66_mcp.PMT <- fortify(F66_mcp.PM, region = "id")

mcp.shift.TEST5 <- ggplot() +
  geom_polygon(data=F114_mcp.EMT, aes(x=F114_mcp.EMT$long, y=F114_mcp.EMT$lat),
               alpha=0.1,colour="blue",linetype=2) +
  geom_polygon(data=F114_mcp.DRYT, aes(x=F114_mcp.DRYT$long, y=F114_mcp.DRYT$lat),
               alpha=0.1,colour="red",linetype=3) +
  geom_polygon(data=F114_mcp.MONT, aes(x=F114_mcp.MONT$long, y=F114_mcp.MONT$lat),
               alpha=0.1,colour="green",linetype=4) +
  geom_polygon(data=F114_mcp.PMT, aes(x=F114_mcp.PMT$long, y=F114_mcp.PMT$lat),
               alpha=0.1,colour="black",linetype=5) +
  geom_polygon(data=F137_mcp.EMT, aes(x=F137_mcp.EMT$long, y=F137_mcp.EMT$lat),
               alpha=0.1,colour="blue",linetype=2) +
  geom_polygon(data=F137_mcp.DRYT, aes(x=F137_mcp.DRYT$long, y=F137_mcp.DRYT$lat),
               alpha=0.1,colour="red",linetype=3) +
  geom_polygon(data=F137_mcp.MONT, aes(x=F137_mcp.MONT$long, y=F137_mcp.MONT$lat),
               alpha=0.1,colour="green",linetype=4) +
  geom_polygon(data=F137_mcp.PMT, aes(x=F137_mcp.PMT$long, y=F137_mcp.PMT$lat),
               alpha=0.1,colour="black",linetype=5) +
  geom_polygon(data=F147_mcp.EMT, aes(x=F147_mcp.EMT$long, y=F147_mcp.EMT$lat),
               alpha=0.1,colour="blue",linetype=2) +
  geom_polygon(data=F147_mcp.DRYT, aes(x=F147_mcp.DRYT$long, y=F147_mcp.DRYT$lat),
               alpha=0.1,colour="red",linetype=3) +
  geom_polygon(data=F147_mcp.MONT, aes(x=F147_mcp.MONT$long, y=F147_mcp.MONT$lat),
               alpha=0.1,colour="green",linetype=4) +
  geom_polygon(data=F147_mcp.PMT, aes(x=F147_mcp.PMT$long, y=F147_mcp.PMT$lat),
               alpha=0.1,colour="black",linetype=5) +
  # geom_polygon(data=F252_mcp.EMT, aes(x=F252_mcp.EMT$long, y=F252_mcp.EMT$lat),
  #              alpha=0.1,colour="black",linetype=2) +
  # geom_polygon(data=F252_mcp.DRYT, aes(x=F252_mcp.DRYT$long, y=F252_mcp.DRYT$lat),
  #              alpha=0.1,colour="black",linetype=3) +
  # geom_polygon(data=F252_mcp.MONT, aes(x=F252_mcp.MONT$long, y=F252_mcp.MONT$lat),
  #              alpha=0.1,colour="black",linetype=4) +
  # geom_polygon(data=F252_mcp.PMT, aes(x=F252_mcp.PMT$long, y=F252_mcp.PMT$lat),
  #              alpha=0.1,colour="black",linetype=5) +
  geom_polygon(data=F36_mcp.EMT, aes(x=F36_mcp.EMT$long, y=F36_mcp.EMT$lat),
               alpha=0.1,colour="blue",linetype=2) +
  geom_polygon(data=F36_mcp.DRYT, aes(x=F36_mcp.DRYT$long, y=F36_mcp.DRYT$lat),
               alpha=0.1,colour="red",linetype=3) +
  geom_polygon(data=F36_mcp.MONT, aes(x=F36_mcp.MONT$long, y=F36_mcp.MONT$lat),
               alpha=0.1,colour="green",linetype=4) +
  geom_polygon(data=F36_mcp.PMT, aes(x=F36_mcp.PMT$long, y=F36_mcp.PMT$lat),
               alpha=0.1,colour="black",linetype=5) +
  geom_polygon(data=F66_mcp.EMT, aes(x=F66_mcp.EMT$long, y=F66_mcp.EMT$lat),
               alpha=0.1,colour="blue",linetype=2) +
  geom_polygon(data=F66_mcp.DRYT, aes(x=F66_mcp.DRYT$long, y=F66_mcp.DRYT$lat),
               alpha=0.1,colour="red",linetype=3) +
  geom_polygon(data=F66_mcp.MONT, aes(x=F66_mcp.MONT$long, y=F66_mcp.MONT$lat),
               alpha=0.1,colour="green",linetype=4) +
  geom_polygon(data=F66_mcp.PMT, aes(x=F66_mcp.PMT$long, y=F66_mcp.PMT$lat),
               alpha=0.1,colour="black",linetype=5) +
  theme_bw() +
  labs(x="Easting (m)", y="Northing (m)") +
  labs(caption = "Figure 11 |  Seasonal home range shifts of five lizards. Emergence and post-monsoon ranges stay realatively within \n each other. All seasonal polygons stay relatively stable without any major shifts away from other seasonal ranges.")+
  theme(plot.caption = element_text(hjust = 0,lineheight = 0.9))+
  theme(legend.position="none", plot.title = element_text(face = "bold", hjust = 0.5))

mcp.shift.TEST5
```


<br>


Seasonal home ranges at Stone Canyon varied in size between seasons but did not seem shift (Fig. 11), with seasonal home ranges overlapping each other, only expanding or collapsing between seasons. Home range patterns at Stone Canyon did not display the same seasonal variation in home range sizes that was observed at Owl Head Buttes. At Stone Canyon, Gila Monsters had relatively smaller home ranges throughout the year, where the highest inflation of range size was observed during the dry season from an increase in male home ranges, 18.3 ± 5.4 S.E. ha to that of female home range sizes at 10.2 ± 2.4 S.E. ha. Females at Stone Canyon displayed similar home ranges during the monsoon season, 10.6 ± 2.5 S.E. ha. Home range sizes at Owl Head Buttes had a much larger amount of variation across seasons than did those at Stone Canyon. There were still slightly larger ranges observed during the dry season, primarily due to increased home range sizes exhibited by males 29.4 ± 4.7 S.E. ha versus females at 15.6 ± 3.8 S.E. ha. During the monsoon season, there was still yet a large influx of home ranges sizes where female home ranges increased to 22.9 ± 4.0 S.E. ha.  For both populations, home ranges during the emergence and post-monsoon seasons were small, marking the beginning and ending of overwintering periods, where minimal movement is observed in both groups. 

Analysis indicated that there was an effect of season (df = 3, F = 15.41, P = <0.001) as well as an interaction of environment and season (df = 3, F = 6.84, P = <0.001), indicating that changes in seasonal home ranges sizes varied between each environment. 
  

<br>



```{r echo=FALSE, message=FALSE, warning=FALSE}
seasonal<-read.csv("SC_Seasonal_Data.csv")

library(Rmisc)

SEAS_GRP_Means <- summarySE(seasonal, measurevar="Home_Range_100mcp",
                            groupvars=c("Environment","Season"), na.rm = TRUE)

# SEAS_GRP_Means
kable(SEAS_GRP_Means, format = "pandoc", caption = 'Table 6 | Group means of seasonal home ranges between Stone Canyon (subsidized) and Owl Head Buttes (non-subsidized). These means are averaged across sex.')
```






```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
library(lme4)
library(readr)
library(lmerTest)
# seasonal<-read.csv("SC_Seasonal_Data.csv")

RM.mod.Season <- lmer(Home_Range_100mcp~Environment+Season+Sex+N+Environment*Season+(1|Gila), 
                      data=seasonal)
summary(RM.mod.Season)

# anova(RM.mod.Season)

# # marginal.season <- lsmeans(RM.mod.Season, 
# #                    ~ Environment)
# # marginal.season
```

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
anova(RM.mod.Season)
```







```{r echo=FALSE, message=FALSE, warning=FALSE}
SEAS_GRP_TEST <- summarySE(seasonal, measurevar="Home_Range_100mcp",
                           groupvars=c("Environment","Season","Sex"), na.rm = TRUE)

# SEAS_GRP_Means
kable(SEAS_GRP_TEST, format = "pandoc", caption = 'Table 7 | Seasonal home range means between Stone Canyon (subsidized) and Owl Head Buttes (non-subsidized) popuations for males and females. These are raw means before being adjusted for environment, season, sex, and sample size.')
```



```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

pd <- position_dodge(0.3) # move them .05 to the left and right ('dodges')

## TEST 3
raw.seasonal<-ggplot(SEAS_GRP_TEST,aes(x=Environment, y=Home_Range_100mcp, shape=Sex)) + 
  geom_point(aes(shape=Sex), size = 2, position=pd) +
  geom_errorbar(aes(ymin=Home_Range_100mcp-se, ymax=Home_Range_100mcp+se), position = pd,
                width=0.3, size=0.5, lty=1) + 
  # scale_colour_manual(values = c('black','red')) +
  facet_grid(~Season) +
  # scale_shape_manual(values = c(8,19))+
  labs(caption = "Figure 12 |  Raw seasonal means of sexes between each environment. Home ranges of the subsidezed population remain \n relatively small throughout the seasons, with the exception during the dry season where we observe increased male \n home ranges. The non-subsidized population exhibits a large amount of variation across seasons.")+
  theme(plot.caption = element_text(hjust = 0,lineheight = 0.9))+
  # scale_x_discrete(limits=c('Emergence','Dry','Monsoon','Post_Monsoon')) +
  theme(legend.position = c(.87,.85), legend.background = element_rect(colour = "black"),
        plot.title = element_text(lineheight=1.5, face="bold", size=rel(1.5), hjust = 0.5),
        axis.text.x  = element_text(vjust=0.5, size=8),
        axis.text.y  = element_text(vjust=0.5, size=8),
        axis.title.y  = element_text(size=10),
        axis.title.x  = element_text(size=10),
        legend.text = element_text(size = 12, face = "bold"),
        strip.text = element_text(size=12)) +
  xlab("Environment") + ylab("Area (ha) using 100% MCP")
raw.seasonal
```





Adjusted Seasonal Means
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
#############################################################################################
## Raw seasonal means
# pd <- position_dodge(0.3) # move them .05 to the left and right ('dodges')
# 
## TEST 3
# raw.seasonal<-ggplot(SEAS_GRP_TEST,aes(x=Environment, y=Home_Range_100mcp, shape=Sex)) +
#   geom_point(aes(shape=Sex), size = 2, position=pd) +
#   geom_errorbar(aes(ymin=Home_Range_100mcp-se, ymax=Home_Range_100mcp+se), position = pd,
#                 width=0.3, size=0.5, lty=1) +
#   # scale_colour_manual(values = c('black','red')) +
#   facet_grid(~Season) +
#   # # scale_shape_manual(values = c(8,19))+
#   # labs(caption = "Figure  |  Raw seasonal means of sexes between each environment. Home ranges of the subsidezed population remain \n relatively small throughout the seasons, with the exception during the dry season where we observe increased male \n home ranges. The non-subsidized population exhibits a large amount of variation across seasons.")+
#   theme(plot.caption = element_text(hjust = 0,lineheight = 0.9))+
#   # scale_x_discrete(limits=c('Emergence','Dry','Monsoon','Post_Monsoon')) +
#   theme(legend.position = c(.87,.85), legend.background = element_rect(colour = "black"),
#         plot.title = element_text(lineheight=1.5, face="bold", size=rel(1.5), hjust = 0.5),
#         axis.text.x  = element_text(vjust=0.5, size=8),
#         axis.text.y  = element_text(vjust=0.5, size=8),
#         axis.title.y  = element_text(size=10),
#         axis.title.x  = element_text(size=10),
#         legend.text = element_text(size = 12, face = "bold"),
#         strip.text = element_text(size=12)) +
#   xlab("") + ylab("")

#############################################################################################
## Ajusted seasonal means
RM.mod.Season <- lmer(Home_Range_100mcp~Environment+Season+Sex+N+Environment*Season+(1|Gila),
                      data=seasonal)

# RM.marginal <- lsmeans(RM.mod.Season, 
#                     ~ Environment)
# RM.marginal

## CATAGORIZE LSM GRAPH BY SEX BETWEEN ENVIRONMENT:
refRM_season <- lsmeans(RM.mod.Season, specs = c("Environment","Season","Sex"))

# refRM_sex
ref_dfRM_season <- as.data.frame(summary(refRM_season))
pd_RM <- position_dodge(0.2)

adj.seasonal<-ggplot(ref_dfRM_season,aes(x=Environment, y=lsmean, shape=Sex)) + 
  geom_point(aes(shape=Sex), size = 2, position=pd, show.legend=TRUE) +
  geom_errorbar(aes(ymin=lsmean-SE, ymax=lsmean+SE), position = pd,
                width=0.3, size=0.5, lty=1) + 
  facet_grid(~Season) +
labs(caption = "Figure 13 | Adjusted seasonal home range means of sexes between environments. Home ranges of the subsidezed \n population remain relatively small throughout the seasons. After adjustment male home reanges were reduced, \n but still remained slightly larger then females.")+
  theme(plot.caption = element_text(hjust = 0,lineheight = 0.9))+
  # scale_shape_manual(values = c(8,19))+
  theme(legend.position = c(.87,.85), legend.background = element_rect(colour = "black"),
        plot.title = element_text(lineheight=1.5, face="bold", size=rel(1.5), hjust = 0.5),
        axis.text.x  = element_text(vjust=0.5, size=8),
        axis.text.y  = element_text(vjust=0.5, size=8),
        axis.title.y  = element_text(size=10),
        axis.title.x  = element_text(size=10),
        legend.text = element_text(size = 12, face = "bold"),
        strip.text = element_text(size=12)) +
  xlab("Environment") + ylab("Area (ha) using 100% MCP")
adj.seasonal

# Combine raw and adjusted seasonal home ranges with a single caption:
# grid.arrange(raw.seasonal, adj.seasonal, nrow = 2,heights=unit(c(2,2), c("in", "in")),
#              bottom = textGrob("",
#                                gp = gpar(fontface = 1,fontsize = 10),hjust = 0, x = 0))

# library(gtable)
# g2 <- ggplotGrob(raw.seasonal)
# g3 <- ggplotGrob(adj.seasonal)
# g <- rbind(g2, g3, size = "first")
# g$widths <- unit.pmax(g2$widths, g3$widths)
# grid.newpage()
# grid.draw(g)

```



<br>



## Post-Hoc Analyses                                                                        

Post-Hoc analyses on the Stone Canyon data set, with home range means averaged across sex, suggested that there was no significant difference in home ranges between the emergence (4.3 ± 2.6 S.E. ha) and post-monsoon seasons (5.1 ± 2.1 S.E. ha) nor dry and monsoon (12.2 ± 1.7 S.E. ha and 9.0 ± 1.8 S.E. ha). There was also no significance between emergence and dry/monsoon seasons, but there was a difference between dry and post-monsoon (df = 80.2, P = 0.04). Post-Hoc analyses on the Owl Head Buttes population indicated that there was no significant difference between emergence (3.3 ± 2.2 S.E. ha) and post-monsoon (2.4 ± 2.4 S.E.) nor dry and monsoon (18.9 ± 2.3 S.E. ha and 21.9 ± 2.0 S.E. ha) reflecting the same pattern at Stone Canyon. However, there was a significant difference between emergence and dry/monsoon (df = 69.4, P = <0.0001, and df = 68, P = <0.0001 respectively), as well as post-monsoon and dry/monsoon (df = 78.9, P = <0.0001, and df = 74, P = <0.0001). This shows a rather different pattern than seen at Stone Canyon. Pairwise analyses between the two populations indicated no difference between emergence (df = 87.7, P = 0.76) or post-monsoon (df = 89.4, P = 0.35). Differences in home range sizes between the two populations were between the dry and monsoon seasons (Fig. 14).  Owl Head home ranges were 58% larger than those at Stone Canyon during the dry season, and 76% larger during the monsoon season. 

<br>


```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
emm_s.t <- emmeans(RM.mod.Season, pairwise ~ Environment | Season)
emm_s.t
```


Graphical Comparisons of seasons between the two populatins:
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
# plot(Sex.emm.seas, comparisons = TRUE)
plot(emm_s.t, comparisons = TRUE)
```                                                                                             
Figure 14 | Pairwise comparisons of each season between environments. Overlapping red bars indicate no statistical difference. 




```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# Seas.MeansT<-emmeans(RM.mod.Season, list(pairwise ~ Environment, pairwise ~ Season))
# Seas.MeansT

emm_s.t4 <- emmeans(RM.mod.Season, pairwise ~ Season | Environment)
emm_s.t4
```


Graphical Comparisons between seasons within the two populations:
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot(emm_s.t4, comparisons = TRUE)
```
Figure 15 | Pairwise comparisons between seasons within each environment against estimated marginal means. Overlapping red bars indicate no statistical difference. 






```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
sub <- subset(seasonal, Environment == "subsidized")

RM.mod.Sub <- lmer(Home_Range_100mcp~Season+Sex+N+Season*Sex+(1|Gila), data=sub)

emm_s.t5 <- emmeans(RM.mod.Sub, pairwise ~ Sex | Season)
emm_s.t5 
```

Graphical Comparisons between sex within the subsidized population:
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot(emm_s.t5, comparisons = TRUE)
```   
Figure 16 | Stone Canyon pairwise comparisons of male and female home ranges of each season.

<br>


```{r message=FALSE, warning=FALSE, include=FALSE}
Seas.Ind.Means<-read.csv("Seasonal HR Table.csv")
kable(Seas.Ind.Means, format = "pandoc", caption = 'Table 7 | Mean individual seasonal home ranges pooled from the entire study period. Missing values are depicted where no locations for that animal during that period were successfull.')
```


```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
nonsub <- subset(seasonal, Environment == "nonsubsidized")

RM.mod.NSub <- lmer(Home_Range_100mcp~Season+Sex+N+Season*Sex+(1|Gila), data=nonsub)

emm_s.t6 <- emmeans(RM.mod.NSub, pairwise ~ Sex | Season)
emm_s.t6 
```

Graphical Comparisons between sex within the non-subsidized population:
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot(emm_s.t6, comparisons = TRUE)
```   
Figure 17 | Owl Head pairwise comparisons of male and female home ranges of each season.


<br>

	KDE analyses were not extended to seasonal home range analyses due to sensitivity to small sample sizes. Small sample sizes and the distribution of relocations have a profound influence on KDE outputs. KDE methods are known to overestimate home ranges with sample sizes that are smaller than adequate, as can be seen with some individuals in the above yearly home range analyses. Because analyzing seasonal home ranges results in reduced data sets, KDE outputs would exhibit large unreasonable inflations in home ranges. 



```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
season.kde<-read.csv("SC_Seasonal_Input.csv")

SEAS_KDE_Sex <- summarySE(season.kde, measurevar="Home_Range_95kde",
                            groupvars=c("Season","Sex"), na.rm = TRUE)

# SEAS_GRP_Means
kable(SEAS_KDE_Sex, format = "pandoc", caption = 'Raw KDE Group Means of Seasonal Home Ranges between sexes')
```

 
```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
SEAS_KDE_Means <- summarySE(season.kde, measurevar="Home_Range_95kde",
                            groupvars=c("Season"), na.rm = TRUE)

# SEAS_GRP_Means
kable(SEAS_KDE_Means, format = "pandoc", caption = 'Raw KDE Group Means of Seasonal Home Ranges')
```
 

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# seasonal<-read.csv("SC_Seasonal_Data.csv")

RM.KDE.Season <- lmer(Home_Range_95kde~Season+Sex+N+Season*Sex+(1|Gila), 
                      data=season.kde)
summary(RM.KDE.Season)
```
 

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
anova(RM.KDE.Season)
```


```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
ggplot(SEAS_KDE_Sex,aes(x=Sex, y=Home_Range_95kde)) + 
  geom_point(size = 2, position=pd) +
  geom_errorbar(aes(ymin=Home_Range_95kde-se, ymax=Home_Range_95kde+se), position = pd,
                width=0.3, size=0.5, lty=1) + 
  facet_grid(~Season) +
  theme_bw() +
  xlab("Sex") + ylab("Area (ha) using 95% KDE")
```


```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
RM.KDE.Season <- lmer(Home_Range_95kde~Season+Sex+N+Season*Sex+(1|Gila), 
                      data=season.kde)

# RM.marginal <- lsmeans(RM.mod.Season, 
#                     ~ Environment)
# RM.marginal

## CATAGORIZE LSM GRAPH BY SEX BETWEEN ENVIRONMENT:
refRM_KDE <- lsmeans(RM.KDE.Season, specs = c("Season","Sex"))

# refRM_sex
ref_dfRM_KDE <- as.data.frame(summary(refRM_KDE))
pd_RM <- position_dodge(0.2)

ggplot(ref_dfRM_KDE,aes(x=Sex, y=lsmean)) + 
  geom_point(size = 2, position=pd) +
  geom_errorbar(aes(ymin=lsmean-SE, ymax=lsmean+SE), position = pd,
                width=0.3, size=0.5, lty=1) + 
  facet_grid(~Season) +
  xlab("Sex") + ylab("Area (ha) using 95% KDE")
```

 
```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
emm_sex_KDE <- emmeans(RM.KDE.Season, pairwise ~ Sex | Season)
emm_sex_KDE 
```


```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
plot(emm_sex_KDE, comparisons=TRUE)
```


<br>


# Home Range Overlap (MCP)

  At Stone Canyon, there was a high degree of overlap of female home ranges with other females as well as considerable overlap with male home ranges (Table 8). There was limited overlap between males, with overlap occurrences observed in only two male-male home ranges: M14-M69 (0.5 ha) and M119-M215 (19.5 ha). Mean female-female overlap was 4.3 ± 0.9 S.E. ha, mean male-male overlap was 10.0 ± 5.5 S.E. ha., and male-female overlap was 5.3 ± 1.8 S.E. ha. Overlap of male home ranges with other males at 10.0 ha. accounted for 16% of their total home range area, while overlap with females at 5.3 ha. accounted for 65% of male home range area. 7.3 ha of female overlap with other female home range area accounted for 29% of female home range area.
  
	At Owl Head Buttes, there was a high scope of home range overlap of male home ranges with other males.  Overlap of female ranges with other females was negligible, with a single occurrence of 0.03 ha.. Male home ranges overlapped with at least one other male with a mean of 18.9 ± 4.5 S.E. ha. and accounted for 78% of their total home range area. Overlap between males and females was more variable with a mean of 13.0 ± 4.2 S.E. ha., accounting for 16% of female home range area.

  Home range sizes vary between individuals of a species (Rose, 1982), as well as between sexes. Male squamates are the mate searching sex of a species, are more active and move greater distances when searching for mates (Duvall, Schuett & Arnold, 1993; Kokko & Wong, 2007; Kwiatkowski et al, 2008; Morreale, Gibbons and Congdon, 1984; Phillips, 1995). At Owl Head Buttes male home ranges were significantly larger than those seen in females. This same pattern is observed in other populations of Gila Monsters … However, male home range size at Stone Canyon was not significantly larger than females, and interestingly they were smaller than those of females at Owl Head Buttes. This attributes to the minor extent of male home range overlap with other males, seen in only two occurrences at Stone Canyon. A result that was quite opposite of that presented at Owl Head Buttes where there was extensive male-male overlap, accounting for 78% of their total home range area. Female-female overlap at Owl Head was minimal with only two occurrences, accounting for a very small proportion of shared home range with other females. However, both populations exhibited extensive male-female overlap. These patterns of shared space between the two populations can be attributed to habitat structure, and spatial resource subsidies available to Gila Monsters. At Stone Canyon, male Gila Monsters are not having to forage as widely for preferred prey items while mate searching during the breeding season. Stone Canyon where there is a higher proportion of female-female home range overlap, females are not as widely spaced as they are at Owl Head, being more concentrated around the greens and peripheral edges of the golf course. Therefore, males gain access to multiple females while exploiting the local inflation of prey availability and water emitted from the surrounding sprinkler systems. Higher prey densities and even potentially an increase in prey diversity provided at the golf course can be attributed to that artifical precipitation provided.  Because of reduced home range sizes, male-male encounters are reduced, yet access to females is maintained with minimal competition. Home range size is thought to be a key attributer to mating and foraging success (Rose, 1982). Large inflations in home range sizes seen male species could be due to an increased frequency in female encounters during the breeding season (Rose, 1981; Ruby, 1976), as well as resource availability, especially in environments where water is a limiting resource. We can observe this in the Owl Head population, where male home ranges are significantly larger than both the females at Owl Head as well as males of the Stone Canyon population. Because female lizards were more widely spaced at Owl Head and resources scarcer, male home ranges inherently need to be larger to maintain metabolic needs as well as access to females during the breeding season (Table x, Figure x). How males use space may be reflected from the efforts of locating and courting females, and when males encounter one another in the proximity of females, contests for that female may develop (Smith, 1985). If females are a contested resource in a male’s area of use then the parameters of a male’s home range should be associated with the locations of females (Haenel et al., 2003), as well as the availability of nutritional resources.  

<br>


```{r echo=FALSE, message=FALSE, warning=FALSE}
OL_Table<-read.csv("./Overlap/OverLap_Table.csv")

kable(OL_Table, format = "pandoc", caption = 'Table 8 | Home range overlap of Gila Monsters at the resource subsidized site. Male-male overlaps only occured between two pairs of males: M14-M69 and M119-M215 at 0.5 ha. and 19.5 ha. respectively and were therefore not included in the table..') 
```



```{r echo=FALSE, message=FALSE, warning=FALSE}
hr.overlap<-read.csv("./Overlap/HR_Overlap_Data.csv")

hr.overlap.anal <- summarySE(hr.overlap, measurevar="OL",
                            groupvars=c("Interaction"), na.rm = TRUE)

# SEAS_GRP_Means
kable(hr.overlap.anal, format = "pandoc", caption = 'Table 9 | Summary of home range overlap.')
```




# Home Range Overlap (KDE)

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=TRUE}

# kde_analysis.href.raster <- function(filename){
#   data <- read.csv(file = filename)
#   x <- as.data.frame(data$EASTING)
#   y <- as.data.frame(data$NORTHING)
#   xy <- c(x,y)
#   data.proj <- SpatialPointsDataFrame(xy,data, proj4string = CRS.SC)
#   xy <- SpatialPoints(data.proj@coords)
#   kde<-kernelUD(xy, h="href", kern="bivnorm", grid=1000)
#   kde@proj4string<- CRS.SC
#   kde
# }

M112.raster.output<-kde_analysis.href.raster("./M112/M112 .csv")
F114.raster.output<-kde_analysis.href.raster("./F114/F114 .csv")
F200.raster.output<-kde_analysis.href.raster("./F200/F200 .csv")
# plot(M112.raster.output)
# mapview(M112.raster.output, alpha.regions=0.8)

M112.raster<-raster(M112.raster.output)
F114.raster<-raster(F114.raster.output)
F200.raster<-raster(F200.raster.output)


library(tmap)
# creates a bounding box based on the extents of the polygon
#bounding_box <- bb(Output.Areas)
M112.bb <- M112_KDE@bbox
F114.bb <- F114_KDE@bbox
F200.bb <- F200_KDE@bbox


# maps the raster within the bounding box
# tm_shape(M112.raster, bbox = M112.bb) + tm_raster("ud")

# mask the raster by the output area polygon
M112.masked <- mask(M112.raster, M112_KDE)
# M112.masked[is.na(M112.masked)] <- 0
F114.masked <- mask(F114.raster, F114_KDE)
# F114.masked[is.na(F114.masked)] <- 0
F200.masked <- mask(F200.raster, F200_KDE)
# F200.masked[is.na(F200.masked)] <- 0

plot(M112.masked)
# mapview(M112.masked, alpha.regions=0.6)

tm_layout(main.title="M112 F114 and F200 KDE Overlap")+tm_shape(M112.masked) +
  tm_raster("ud", style = "quantile", n = 100, legend.show = FALSE, palette = "-YlGnBu") +
  tm_shape(F114.masked) + 
  tm_raster("ud", style = "quantile", n = 100, legend.show = FALSE, palette = "-YlGnBu") +
  tm_shape(F200.masked) +
  tm_raster("ud", style = "quantile", n = 100, legend.show = FALSE, palette = "-YlGnBu") +
  tm_shape(M112_KDE) + 
  tm_borders(alpha=.3, col = "black") + 
  tm_shape(F114_KDE) + 
  tm_borders(alpha=.3, col = "black") + 
  tm_shape(F200_KDE) + 
  tm_borders(alpha=.3, col = "black") +
  tm_layout(frame = FALSE)
  
# , bbox = M112.bb
# compute homeranges for 50%, 95% of points, objects are returned as spatial polygon data frames
M112.range95 <- getverticeshr(M112.raster.output, percent = 95)
M112.range50 <- getverticeshr(M112.raster.output, percent = 50)
F114.range95 <- getverticeshr(F114.raster.output, percent = 95)
F114.range50 <- getverticeshr(F114.raster.output, percent = 50)
F200.range95 <- getverticeshr(F200.raster.output, percent = 95)
F200.range50 <- getverticeshr(F200.raster.output, percent = 50)

tm_layout(main.title="M112 F114 and F200 KDE Overlap")+
tm_shape(M112.range95) + 
  tm_borders(alpha=.7, col = "#fb6a4a", lwd = 2) + tm_fill(alpha=.1, col = "#fb6a4a") +
tm_shape(M112.range50) + tm_borders(alpha=.7, col = "#de2d26", lwd = 2) + tm_fill(alpha=.1, col = "#de2d26") +
tm_layout(frame = FALSE) +
tm_shape(F114.range95) + tm_borders(alpha=.7, col = "#fb6a4a", lwd = 2) + tm_fill(alpha=.1, col = "#fb6a4a") +
tm_shape(F114.range50) + tm_borders(alpha=.7, col = "#de2d26", lwd = 2) + tm_fill(alpha=.1, col = "#de2d26") +
tm_layout(frame = FALSE) + 
tm_shape(F200.range95) + tm_borders(alpha=.7, col = "#fb6a4a", lwd = 2) + tm_fill(alpha=.1, col = "#fb6a4a") +
tm_shape(F200.range50) + tm_borders(alpha=.7, col = "#de2d26", lwd = 2) + tm_fill(alpha=.1, col = "#de2d26") +
tm_layout(frame = FALSE)

## write raster files to computer: 
# writeRaster(masked_kde, filename = "kernel_density.tif")
```




